<!DOCTYPE html><html lang="zhCN"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="description" content="_FIS_构建工具_前端工具框架"><meta name="keywords" content=",百度前端团队,FIS,百度FIS,百度前端,fis,前端模块化,前端工程,性能优化,web performance"><title>解决方案封装</title><meta name="author" content="fis team"><!-- Enable responsive viewport --><meta name="viewport" content="width=device-width,initial-scale=1"><link href="/css/normalize.css" rel="stylesheet"><link href="/css/main.css" rel="stylesheet"><!-- Custom styles --><link href="/css/style.css?body=1" rel="stylesheet" type="text/css" media="all"><!--<link href="//css/highlight/monokai_sublime.css" rel="stylesheet" type="text/css" media="all">--><link href="/css/pygments/github.css" rel="stylesheet" type="text/css" media="all"><link href="/css/perfect-scrollbar.min.css" rel="stylesheet"><link href="assets/css/font-awesome.min.css" rel="stylesheet" type="text/css" media="all"><script type="text/javascript"></script><!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries --><!-- WARNING: Respond.js doesn't work if you view the page via file:// --><!--[if lt IE 9]>
    <script src="/js/html5shiv.js"></script>
    <script src="/js/respond.min.js"></script>
    <![endif]--><!-- Fav and touch icons --><!-- Update these with your own images
      <link rel="shortcut icon" href="images/favicon.ico">
      <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
      <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
      <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
    --><script src="/js/jquery.min.js"></script><script src="/js/scrollspy.js"></script></head><body><header class="navbar"><section><a href="/fis-site/index.html"><div class="logo"><i class="fa fa-cogs"></i> F.I.S - 前端工具框架</div></a><div class="nav-items"><a href="/fis-site/index.html"><div class="nav-item">首页</div></a> <a href="/fis-site/docs/beginning/getting-started.html"><div class="nav-item">使用文档</div></a> <a href="http://oak.baidu.com"><div class="nav-item">解决方案</div></a> <a target="_blank" href="http://www.imooc.com/learn/220"><div class="nav-item">在线课程</div></a> <a target="_blank" href="http://fex.baidu.com"><div class="nav-item">FEX官网</div></a></div></section></header><div id="wrap"><aside><nav class="sidebar"><ul><li class="item-category"><a href="/fis-site/docs/beginning/getting-started.html">快速入门</a></li><li class="item-sub"><a href="/fis-site/docs/beginning/getting-started.html#optimize">资源压缩</a></li><li class="item-sub"><a href="/fis-site/docs/beginning/getting-started.html#combine">资源合并</a></li><li class="item-sub"><a href="/fis-site/docs/beginning/assist.html">辅助开发</a></li><li class="item-sub"><a href="/fis-site/docs/api/cli.html">命令行</a></li><li class="item-category"><span>进阶使用</span></li><li class="item-sub"><a href="/fis-site/docs/more/fis-standard.html#资源定位">资源定位</a></li><li class="item-sub"><a href="/fis-site/docs/more/fis-standard.html#内容嵌入">内容嵌入</a></li><li class="item-sub"><a href="/fis-site/docs/more/fis-standard.html#依赖声明">依赖声明</a></li><li class="item-sub"><a href="/fis-site/docs/advance/roadmap.html">roadmap详解</a></li><li class="item-sub"><a href="/fis-site/docs/advance/modjs-solution.html">前端模块化</a></li><li class="item-sub"><a href="/fis-site/docs/advance/plugin-list.html">更多插件</a></li><li class="item-category"><a href="/fis-site/docs/dev/intro.html">二次开发</a></li><li class="item-sub"><a href="/fis-site/docs/dev/plugin.html">插件开发</a></li><li class="item-sub"><a href="/fis-site/docs/dev/solution.html">解决方案封装</a></li><li class="item-category"><a href="/fis-site/docs/dev/more.html">更多文档</a></li><li class="item-category"><a href="/fis-site/docs/api/fis-conf.html">配置API</a></li><li class="item-sub"><a href="/fis-site/docs/api/fis-conf.html">配置文件</a></li><li class="item-sub"><a href="/fis-site/docs/api/fis-conf.html#project">project</a></li><li class="item-sub"><a href="/fis-site/docs/api/fis-conf.html#modules">modules</a></li><li class="item-sub"><a href="/fis-site/docs/api/fis-conf.html#settings">settings</a></li><li class="item-sub"><a href="/fis-site/docs/api/fis-conf.html#roadmap">roadmap</a></li><li class="item-sub"><a href="/fis-site/docs/api/fis-conf.html#pack">pack</a></li><li class="item-sub"><a href="/fis-site/docs/api/fis-conf.html#deploy">deploy</a></li><li class="item-category"><a href="/fis-site/docs/api/dev.html">插件开发API</a></li><li class="item-category"><a href="/fis-sitehttps://github.com/fex-team/fis/issues/new">问题反馈</a></li><li class="item-category"><a href="/fis-sitehttps://github.com/fex-team/fis/issues?labels=faq&page=1&state=open">FAQ</a></li></ul></nav><div class="bottom-shadow"></div></aside><div class="container"><article class="doc-content"><div class="toc affix"></div><h1>解决方案封装</h1><h2>什么时候需要封装？</h2><ul><li>现有解决不能满足你的需求：<a href="https://github.com/fex-team/fis-plus">fis-plus</a>, <a href="https://github.com/fex-team/jello">jello</a>, <a href="https://github.com/fouber/spmx">spmx</a>, <a href="https://github.com/fouber/phiz/">phiz</a>, <a href="https://github.com/xiangshouding/gois">gois</a>。</li><li>基于某一解决方案，需要配置的东西和安装的插件过多，不便于组内交接。</li><li>需要覆写某些插件。</li><li>你想采用更 nice 的命令名字。</li></ul><h2>如何封装？</h2><ol><li>先取一个名字，以下示例就用 hello 作为命令名字吧。</li><li>新建一个入口 js 文件。如： index.js</li><li><p>npm init 初始化项目</p><div class="highlight"><pre><code class="language-bash" data-lang="bash">~/projects/hello touch index.js
~/projects/hello npm init
This utility will walk you through creating a package.json file.
It only covers the most common items, and tries to guess sane defaults.

See <span class="sb">`</span>npm <span class="nb">help </span>json<span class="sb">`</span> <span class="k">for </span>definitive documentation on these fields
and exactly what they <span class="k">do</span>.

Use <span class="sb">`</span>npm install &lt;pkg&gt; --save<span class="sb">`</span> afterwards to install a package and
save it as a dependency <span class="k">in </span>the package.json file.

Press ^C at any <span class="nb">time </span>to quit.
name: <span class="o">(</span>hello<span class="o">)</span>
version: <span class="o">(</span>0.0.0<span class="o">)</span> 0.0.1
description: hello
entry point: <span class="o">(</span>index.js<span class="o">)</span>
<span class="nb">test command</span>:
git repository:
keywords: fis
author: name
license: <span class="o">(</span>ISC<span class="o">)</span> BSD
About to write to /Users/liaoxuezhi/projects/hello/package.json:

<span class="o">{</span>
  <span class="s2">"name"</span>: <span class="s2">"hello"</span>,
  <span class="s2">"version"</span>: <span class="s2">"0.0.1"</span>,
  <span class="s2">"description"</span>: <span class="s2">"hello"</span>,
  <span class="s2">"main"</span>: <span class="s2">"index.js"</span>,
  <span class="s2">"scripts"</span>: <span class="o">{</span>
    <span class="s2">"test"</span>: <span class="s2">"echo </span><span class="se">\"</span><span class="s2">Error: no test specified</span><span class="se">\"</span><span class="s2"> &amp;&amp; exit 1"</span>
  <span class="o">}</span>,
  <span class="s2">"keywords"</span>: <span class="o">[</span>
    <span class="s2">"fis"</span>
  <span class="o">]</span>,
  <span class="s2">"author"</span>: <span class="s2">"name"</span>,
  <span class="s2">"license"</span>: <span class="s2">"BSD"</span>
<span class="o">}</span>

Is this ok? <span class="o">(</span>yes<span class="o">)</span> yes
~/projects/hello
</code></pre></div></li><li><p>安装 fis 依赖</p><div class="highlight"><pre><code class="language-bash" data-lang="bash">npm install fis --save
</code></pre></div></li><li><p>修改 index.js 内容为：</p><div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">fis</span> <span class="o">=</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'fis'</span><span class="p">);</span>

<span class="nx">fis</span><span class="p">.</span><span class="nx">cli</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s1">'hello'</span><span class="p">;</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">cli</span><span class="p">.</span><span class="nx">info</span> <span class="o">=</span> <span class="nx">fis</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">readJSON</span><span class="p">(</span><span class="nx">__dirname</span> <span class="o">+</span> <span class="s1">'/package.json'</span><span class="p">);</span>
</code></pre></div></li><li><p>新建 hello bin 文件。</p><div class="highlight"><pre><code class="language-bash" data-lang="bash">~/projects/hello mkdir bin
~/projects/hello touch bin/hello
~/projects/hello <span class="nb">echo</span> <span class="s2">"require('../hello.js').cli.run( process.argv );"</span> &gt;&gt; bin/hello
</code></pre></div></li><li><p>到此一个简单的包装已经完成，此 hello 项目安装到 global 后，已经具有所有 fis 所有的功能。</p></li></ol><h2>捆绑插件</h2><p>可以把一些常用的插件捆绑进来，比如 fis 中没有捆绑 markdown 的解析器，以下示例把 markdown 的解析器捆绑进来。</p><ol><li><p><code>npm install fis-parser-marked --save</code></p><p>执行完成后可以发现 <code>package.json</code> 文件里面多了一个依赖。</p><div class="highlight"><pre><code class="language-json" data-lang="json"><span class="s2">"dependencies"</span><span class="err">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"fis"</span><span class="p">:</span><span class="w"> </span><span class="s2">"~1.7.9"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"fis-parser-marked"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.0.1"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></li><li><p>修改 hello.js， 添加配置项，开启此插件。</p><div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
    <span class="na">roadmap</span> <span class="p">:</span> <span class="p">{</span>
        <span class="na">ext</span> <span class="p">:</span> <span class="p">{</span>
            <span class="na">md</span> <span class="p">:</span> <span class="s1">'html'</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="na">modules</span> <span class="p">:</span> <span class="p">{</span>
        <span class="na">parser</span> <span class="p">:</span> <span class="p">{</span>
            <span class="na">md</span> <span class="p">:</span> <span class="s1">'marked'</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>
</code></pre></div></li><li><p>到此 <code>fis-parser-marked</code> 便捆绑进了 hello 工具中，其他人员只需安转 hello 就可以使用 md 文件自动装成 html 的功能。</p></li></ol><h2>覆写插件</h2><p>写过 node 的同学应该都知道 require 的查找顺序，比如 require(&#39;fis-command-release&#39;)。当第一次加载此模块的时候，先会尝试当前脚本所在的目录下查找 node_modules/fis-command-release 模块，如果没找到，再往上级目录找，直到找到或者没有上级目录了为止。那么，当fis cli执行的时候，require 某个命令模块，其实最先找到的是 fis 模块下的 fis-command-xxx 然后才是 hello 模块的 fis-command-xxx。如是出现了一个问题，就是我们的模块里面只能新加模块，而不能覆写模块。</p><p>的确，之前确实是这样的，好在 fis 内部所有 require 模块的地方不是直接使用系统的require 方法，而是 fis.require 方法。如是，小修改了下逻辑，原来是固定查找 fis- 打头的插件，现在你可以控制，让其先加载 hello- 打头的插件，然后才查找 fis- 打头的插件。</p><div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">fis</span><span class="p">.</span><span class="nx">require</span><span class="p">.</span><span class="nx">prefixes</span><span class="p">.</span><span class="nx">unshift</span><span class="p">(</span><span class="s1">'hello'</span><span class="p">);</span>
</code></pre></div><p>如是，在 hello 模块下安装 hello-command-release 便可以优先与 fis-command-release 被加载，如此实现了对 <code>hello release</code> 命令的覆写。</p><h2>更多扩展</h2><p>原来写在 fis-conf.js 的内容，如果足够通用，其实可以完全写在 hello.js 文件里面。这样封装好后，其他同学可以减少使用成本。</p><p>更多配置移步到<a href="http://fex-team.github.io/fis-site/docs/api/fis-conf.html">配置API</a>页面。</p><!--  --><br><strong>有任何问题，请在 <a href="https://github.com/fex-team/fis/issues">https://github.com/fex-team/fis/issues</a> 讨论</strong></article><script type="text/javascript">$("a").each(function(t,r){0===$(r).attr("href").indexOf("/")?$(r).attr("href",""+$(r).attr("href")):0!==$(r).attr("href").indexOf("#")&&$(r).attr("target","_blank")});</script><script type="text/javascript" src="/js/document.js"></script></div></div><script type="text/javascript">var _bdhmProtocol="https:"==document.location.protocol?" https://":" http://";document.write(unescape("%3Cscript src='"+_bdhmProtocol+"hm.baidu.com/h.js%3F4206d67a3ea708c0d2a9354c8d88525f' type='text/javascript'%3E%3C/script%3E"));</script><!-- Latest compiled and minified JavaScript, requires jQuery 1.x (2.x not supported in IE8) --><!-- Placed at the end of the document so the pages load faster --><script src="/js/perfect-scrollbar.min.js"></script><script type="text/javascript">!function(){function e(e,n){var i=$('<div style="display:none;"/>').appendTo($("body"));i.html("<!--[if "+(n||"")+" IE "+(e||"")+"]><a>&nbsp;</a><![endif]-->");var o=i.find("a").length;return i.remove(),o}function n(){function e(){i||(console.log("enable"),i=!0,$(".sidebar").perfectScrollbar({wheelSpeed:10,wheelPropagation:!1}))}function n(){i&&(console.log("disable"),i=!1,$(".sidebar").perfectScrollbar("destroy"))}$(window).width()>760&&$(".sidebar").height()<$(".sidebar ul").height()?e():n()}var i=!1;e(8,"lte")||($(".sidebar").addClass("scrollbar"),n(),$(window).resize(n))}();</script></body></html>