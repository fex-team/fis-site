<!DOCTYPE html><html lang="zhCN"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="description" content="_FIS_构建工具_前端工具框架"><meta name="keywords" content=",百度前端团队,FIS,百度FIS,百度前端,fis,前端模块化,前端工程,性能优化,web performance"><title>不完全正则指南- F.I.S</title><meta name="author" content="fis team"><!-- Enable responsive viewport --><meta name="viewport" content="width=device-width,initial-scale=1"><link href="/assets/themes//css/normalize.css" rel="stylesheet"><link href="/assets/themes//css/main.css" rel="stylesheet"><!-- Custom styles --><link href="/assets/themes//css/style.css?body=1" rel="stylesheet" type="text/css" media="all"><!--<link href="/assets/themes///css/highlight/monokai_sublime.css" rel="stylesheet" type="text/css" media="all">--><link href="/assets/themes//css/pygments/github.css" rel="stylesheet" type="text/css" media="all"><link href="/assets/themes//css/perfect-scrollbar.min.css" rel="stylesheet"><link href="assets/css/font-awesome.min.css" rel="stylesheet" type="text/css" media="all"><script type="text/javascript"></script><!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries --><!-- WARNING: Respond.js doesn't work if you view the page via file:// --><!--[if lt IE 9]>
    <script src="/assets/themes//js/html5shiv.js"></script>
    <script src="/assets/themes//js/respond.min.js"></script>
    <![endif]--><!-- Fav and touch icons --><!-- Update these with your own images
      <link rel="shortcut icon" href="images/favicon.ico">
      <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
      <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
      <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
    --><script src="/assets/themes//js/jquery.min.js"></script><script src="/assets/themes//js/scrollspy.js"></script></head><body><header class="navbar"><section><a href="/fis-site/index.html"><div class="logo"><i class="fa fa-cogs"></i> F.I.S - 前端工具框架</div></a><div class="nav-items"><a href="/fis-site/index.html"><div class="nav-item">首页</div></a> <a href="/fis-site/docs/beginning/getting-started.html"><div class="nav-item">使用文档</div></a> <a href="http://oak.baidu.com"><div class="nav-item">解决方案</div></a> <a target="_blank" href="http://www.imooc.com/learn/220"><div class="nav-item">在线课程</div></a> <a target="_blank" href="http://fex.baidu.com"><div class="nav-item">FEX官网</div></a></div></section></header><div id="wrap"><aside><nav class="sidebar"><ul><li class="item-category"><a href="/fis-site/docs/beginning/getting-started.html">快速入门</a></li><li class="item-sub"><a href="/fis-site/docs/beginning/getting-started.html#optimize">资源压缩</a></li><li class="item-sub"><a href="/fis-site/docs/beginning/getting-started.html#combine">资源合并</a></li><li class="item-sub"><a href="/fis-site/docs/beginning/assist.html">辅助开发</a></li><li class="item-sub"><a href="/fis-site/docs/api/cli.html">命令行</a></li><li class="item-category"><span>进阶使用</span></li><li class="item-sub"><a href="/fis-site/docs/more/fis-standard.html#资源定位">资源定位</a></li><li class="item-sub"><a href="/fis-site/docs/more/fis-standard.html#内容嵌入">内容嵌入</a></li><li class="item-sub"><a href="/fis-site/docs/more/fis-standard.html#依赖声明">依赖声明</a></li><li class="item-sub"><a href="/fis-site/docs/advance/roadmap.html">roadmap详解</a></li><li class="item-sub"><a href="/fis-site/docs/advance/modjs-solution.html">前端模块化</a></li><li class="item-sub"><a href="/fis-site/docs/advance/plugin-list.html">更多插件</a></li><li class="item-category"><a href="/fis-site/docs/dev/intro.html">二次开发</a></li><li class="item-sub"><a href="/fis-site/docs/dev/plugin.html">插件开发</a></li><li class="item-sub"><a href="/fis-site/docs/dev/solution.html">解决方案封装</a></li><li class="item-category"><a href="/fis-site/docs/dev/more.html">更多文档</a></li><li class="item-category"><a href="/fis-site/docs/api/fis-conf.html">配置API</a></li><li class="item-sub"><a href="/fis-site/docs/api/fis-conf.html">配置文件</a></li><li class="item-sub"><a href="/fis-site/docs/api/fis-conf.html#project">project</a></li><li class="item-sub"><a href="/fis-site/docs/api/fis-conf.html#modules">modules</a></li><li class="item-sub"><a href="/fis-site/docs/api/fis-conf.html#settings">settings</a></li><li class="item-sub"><a href="/fis-site/docs/api/fis-conf.html#roadmap">roadmap</a></li><li class="item-sub"><a href="/fis-site/docs/api/fis-conf.html#pack">pack</a></li><li class="item-sub"><a href="/fis-site/docs/api/fis-conf.html#deploy">deploy</a></li><li class="item-category"><a href="/fis-site/docs/api/dev.html">插件开发API</a></li><li class="item-category"><a href="/fis-sitehttps://github.com/fex-team/fis/issues/new">问题反馈</a></li><li class="item-category"><a href="/fis-sitehttps://github.com/fex-team/fis/issues?labels=faq&page=1&state=open">FAQ</a></li></ul></nav><div class="bottom-shadow"></div></aside><div class="container"><article class="doc-content"><div class="toc affix"></div><h1>不完全正则指南</h1><h2>写在前面</h2><p>本文只会描述FIS使用中的正则使用技巧，不会全面覆盖正则的使用技巧，建议希望完整的正则学习的同学可以参考<a href="http://www.cnblogs.com/deerchao/archive/2006/08/24/zhengzhe30fengzhongjiaocheng.html">正则表达式30分钟入门教程</a></p><h2>什么是正则</h2><blockquote><p>在编写处理字符串的程序或网页时，经常会有查找符合某些复杂规则的字符串的需要。正则表达式就是用于描述这些规则的工具。换句话说，正则表达式就是记录文本规则的代码。</p></blockquote><p>在FIS中，我们使用正则表达式主要用于在目录规范配置 <code>roadmap.path</code> 中处理路径匹配，只有将文件或目录路径匹配正确，我们才能为其设置目录规范。</p><p>在Javascript中，我们声明正则表达式有两种方式</p><div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">//直接书写表达式</span>
<span class="kd">var</span> <span class="nx">regex</span> <span class="o">=</span> <span class="sr">/123/</span><span class="p">;</span>

<span class="c1">//通过字符串生成表达式</span>
<span class="kd">var</span> <span class="nx">regex</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s1">'123'</span><span class="p">);</span>
</code></pre></div><p>我们一般使用第一种方式编写正则表达式，通过两个 <code>/</code> 号包裹的就是我们的正则表达式。 <code>/123/</code> 将会匹配所有包含 <code>123</code> 的文本。</p><h2>测试正则</h2><p>由于正则表达式较为复杂，因为一个好的调试工具是必须的，个人经常使用的有以下几个</p><ul><li><a href="https://www.debuggex.com/">debuggex</a>，图形化的正则表达式展示，适合用于解析复杂的正则表达式</li><li><a href="http://regex101.com/#javascript">regex101</a>，详细的匹配内容展示，非常适合调试正则表达式</li><li><a href="http://www.regexr.com/">regexr</a>，与regex101功能相似，可以按照个人喜好使用</li></ul><p>也建议在下面的学习中多使用上面的工具自己尝试匹配一下</p><h2>基本语法</h2><h3>元字符</h3><p>在正则表达式中，除了一些特殊符号由于另作他用无法直接使用外，类似a-Z, 0-9等字符都是可以直接使用用于匹配的</p><div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">//匹配所有包含hello world的字符串</span>
<span class="kd">var</span> <span class="nx">regex</span> <span class="o">=</span> <span class="sr">/hello world/</span><span class="p">;</span>
</code></pre></div><p>当然如果我们全部都直接按照原字符编写的话就无法达到通配的效果了，因此正则表达式还提供了一些 <strong>元字符</strong> 用于处理通用匹配需求，此处列举一些常用的元字符</p><table><thead><tr><th>字符</th><th>说明</th></tr></thead><tbody><tr><td>.</td><td>匹配除换行符以外的任意字符</td></tr><tr><td>\w</td><td>匹配字母或数字或下划线或汉字 <code>[a-zA-Z0-9_]</code></td></tr><tr><td>\s</td><td>匹配任意的空白符 <code>[\r\n\t\f]</code></td></tr><tr><td>\d</td><td>匹配数字</td></tr><tr><td>\b</td><td>匹配单词的开始或结束</td></tr><tr><td>^</td><td>匹配字符串的开始</td></tr><tr><td>$</td><td>匹配字符串的结束</td></tr></tbody></table><h3>重复限定符</h3><p>只有用于处理通配效果的元字符很明显是不够的，因此正则表达式还拥有一系列的限定符用于描述字符的重复情况</p><table><thead><tr><th>字符</th><th>说明</th></tr></thead><tbody><tr><td>*</td><td>重复零次或更多次</td></tr><tr><td>+</td><td>重复一次或更多次</td></tr><tr><td>?</td><td>重复零次或一次</td></tr><tr><td>{n}</td><td>重复n次</td></tr><tr><td>{n,}</td><td>重复n次或更多次</td></tr><tr><td>{n,m}</td><td>重复n到m次</td></tr></tbody></table><p>通过元字符与重复限定符的结合使用，我们就可以匹配各种形式的字符串了</p><div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">//匹配除换行符外的任意字符任意次</span>
<span class="kd">var</span> <span class="nx">regex</span> <span class="o">=</span> <span class="sr">/.*/</span><span class="p">;</span>

<span class="c1">//匹配[a-zA-Z0-9_]至少一次</span>
<span class="nx">regex</span> <span class="o">=</span> <span class="sr">/</span><span class="se">\w</span><span class="sr">+/</span><span class="p">;</span>

<span class="c1">//匹配数字字符2次</span>
<span class="nx">regex</span> <span class="o">=</span> <span class="sr">/</span><span class="se">\d{2}</span><span class="sr">/</span><span class="p">;</span>

<span class="c1">//匹配数字字符2-4次</span>
<span class="nx">regex</span> <span class="o">=</span> <span class="sr">/</span><span class="se">\d{2,4}</span><span class="sr">/</span><span class="p">;</span>

<span class="c1">//匹配所有js文件</span>
<span class="nx">regex</span> <span class="o">=</span> <span class="sr">/.*</span><span class="se">\.</span><span class="sr">js$/</span><span class="p">;</span>
</code></pre></div><h3>字符转义</h3><p>如果你想查找元字符或限定符本身的话，比如你查找 <code>.</code> 或者 <code>\*</code> ，就出现了问题：你没办法指定它们，因为它们会被解释成别的意思。这时你就得使用 <code>\</code> 来取消这些字符的特殊意义。因此，你应该使用 <code>\.</code> 和 <code>\*</code> 。当然，要查找\本身，你也得用 <code>\\</code>。</p><p>这在路径匹配中十分常见，在<strong>FIS中</strong>，无论在windows还是unix下，我们均可以用 <code>\/</code> 来匹配目录分隔符</p><div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">//匹配 /modules/moduleA</span>
<span class="kd">var</span> <span class="nx">regex</span> <span class="o">=</span> <span class="sr">/</span><span class="se">\/</span><span class="sr">modules</span><span class="se">\/</span><span class="sr">moduleA/</span><span class="p">;</span>
</code></pre></div><h3>分支条件</h3><p>如果我们希望一部分的正则表达式可以按两种模式匹配，那么我们可以利用分支条件来指定多种规则，具体的方法是使用 <code>|</code> 分开不同的规则</p><div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">//匹配js文件</span>
<span class="kd">var</span> <span class="nx">regex</span> <span class="o">=</span> <span class="sr">/.*</span><span class="se">\.</span><span class="sr">js$/</span><span class="p">;</span>

<span class="c1">//匹配css文件</span>
<span class="nx">regex</span> <span class="o">=</span> <span class="sr">/.*</span><span class="se">\.</span><span class="sr">css$/</span><span class="p">;</span>

<span class="c1">//匹配js或css文件</span>
<span class="nx">regex</span> <span class="o">=</span> <span class="sr">/.*</span><span class="se">\.</span><span class="sr">js$|.*</span><span class="se">\.</span><span class="sr">css$/</span><span class="p">;</span>

<span class="c1">//匹配js或css文件</span>
<span class="nx">regex</span> <span class="o">=</span> <span class="sr">/.*</span><span class="se">\.(</span><span class="sr">js|css</span><span class="se">)</span><span class="sr">$/</span><span class="p">;</span>
</code></pre></div><h3>反义</h3><p>有时候需要匹配除了某种字符以外的所有字符，这种时候我们就可以利用反义功能来定义字符</p><table><thead><tr><th>字符</th><th>说明</th></tr></thead><tbody><tr><td>\W</td><td>匹配任意不是字母，数字，下划线，汉字的字符</td></tr><tr><td>\S</td><td>匹配任意不是空白符的字符</td></tr><tr><td>\D</td><td>匹配任意非数字的字符</td></tr><tr><td>\B</td><td>匹配不是单词开头或结束的位置</td></tr><tr><td>[^x]</td><td>匹配除了x以外的任意字符</td></tr><tr><td>[^aeiou]</td><td>匹配除了aeiou这几个字母以外的任意字符</td></tr></tbody></table><p>举一个FIS中经常用到的例子，如果我们只要匹配某个目录下一级目录的内容，那么很自然我们需要将目录分隔符 <code>\/</code> 排除在匹配内容之外，这时我们就可以使用 <code>[^\/]</code>来满足需求</p><div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">//匹配 /modules 一级目录下的所有js</span>
<span class="kd">var</span> <span class="nx">regex</span> <span class="o">=</span> <span class="sr">/</span><span class="se">\/</span><span class="sr">modules</span><span class="se">\/[^\/]</span><span class="sr">+</span><span class="se">\.</span><span class="sr">js/</span><span class="p">;</span>

<span class="c1">// /moudles/a.js ok</span>
<span class="c1">// /moudles/a.css ok</span>
<span class="c1">// /moudles/moduleA/a.js fail</span>
</code></pre></div><h3>分组与捕获</h3><p>分组功能可以将指定的正则表达式声明为子表达式，那么我们很多操作就可以针对子表达式进行，比如重复、分支</p><div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// 对子表达式进行重复设定，匹配abab</span>
<span class="kd">var</span> <span class="nx">regex</span> <span class="o">=</span> <span class="sr">/</span><span class="se">(</span><span class="sr">ab</span><span class="se">){2}</span><span class="sr">/</span><span class="p">;</span>

<span class="c1">// 限定分支，公用其余匹配条件，仅在js和css处使用分支，匹配所有js与css文件</span>
<span class="nx">regex</span> <span class="o">=</span> <span class="sr">/.*</span><span class="se">\/(</span><span class="sr">js|css</span><span class="se">)</span><span class="sr">/</span><span class="p">;</span>
</code></pre></div><p>分组除了子表达式声明功能外，还可以将分组保存入捕获组，捕获组的概念可以理解为变量，子表达式匹配到的内容就会存放到这个变量中。</p><div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">//匹配 /modules 目录下的所有js文件，同时捕获 /modules与.js之间的所有内容</span>
<span class="kd">var</span> <span class="nx">regex</span> <span class="o">=</span> <span class="sr">/^</span><span class="se">\/</span><span class="sr">modules</span><span class="se">\/(</span><span class="sr">.*</span><span class="se">)\.</span><span class="sr">js$/</span><span class="p">;</span>

<span class="c1">// /moudles/moudleA/a.js 分组内容为 moudleA/a</span>
</code></pre></div><p>在FIS中，如果在 <code>reg</code> 设置了分组，那么在规范设定时， <code>release</code> 属性和 <code>id</code> 属性均可以通过变量进行引用</p><div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'roadmap.path'</span><span class="p">,</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="na">reg</span> <span class="p">:</span> <span class="sr">/^</span><span class="se">\/</span><span class="sr">modules</span><span class="se">\/(</span><span class="sr">.*</span><span class="se">)\.</span><span class="sr">js$/</span><span class="p">,</span>
        <span class="na">release</span> <span class="p">:</span> <span class="s1">'/static/$&amp;'</span><span class="p">,</span>
        <span class="na">id</span> <span class="p">:</span> <span class="s1">'$1'</span>
    <span class="p">}</span>
<span class="p">]);</span>
</code></pre></div><p>其中 <code>$1</code> 就是对捕获组的引用，如果正则表达式中有多个分组，则会按照他们的出现顺序，按照$1, $2, $3的形式进行引用，而 <code>$&amp;</code> 则表示的是整个正则表达式匹配的内容。</p><p>因此以 <code>/moudles/moudleA/a.js</code> 为例，在上述规则中，release的值会设置为 <code>/static/moudles/moudleA/a.js</code> ，id的值会设置为 <code>moduleA/a</code> 。</p><h3>处理选项</h3><p>Javascript中我们拥有3种处理选项</p><table><thead><tr><th>字符</th><th>说明</th></tr></thead><tbody><tr><td>i</td><td>忽略大小写</td></tr><tr><td>g</td><td>多次匹配，适用于希望正则表达式在字符串中进行多次匹配而不是匹配到第一个内容就返回</td></tr><tr><td>m</td><td>多行匹配模式，^与$将会在每行独立计算而不是整体计算</td></tr></tbody></table><p>FIS中由于我们的正则表达式均是用来匹配路径，因此我们一般只会使用i模式用于忽略路径中的大小写，使用方法是在正则表达式的最后加上处理选项字符</p><div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'roadmap.path'</span><span class="p">,</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="na">reg</span> <span class="p">:</span> <span class="sr">/^</span><span class="se">\/</span><span class="sr">modules</span><span class="se">\/(</span><span class="sr">.*</span><span class="se">)\.</span><span class="sr">js$/i</span><span class="p">,</span>
        <span class="na">release</span> <span class="p">:</span> <span class="s1">'/static/modules/$&amp;'</span><span class="p">,</span>
        <span class="na">id</span> <span class="p">:</span> <span class="s1">'$1'</span>
    <span class="p">}</span>
<span class="p">]);</span>
</code></pre></div><p>这样我们的规则就可以同时处理/MOUDLES/MODULEA/a.js与/moudles/moduleA/a.js了。</p><h2>最后</h2><p>学好正则不仅仅会帮助你使用FIS，本文仅着重介绍了在FIS配置时会用到的一些正则知识，强烈建议大家在有时间的时候对正则进行一次全面的学习。</p><!--  --><br><strong>有任何问题，请在 <a href="https://github.com/fex-team/fis/issues">https://github.com/fex-team/fis/issues</a> 讨论</strong></article><script type="text/javascript">$("a").each(function(t,r){0===$(r).attr("href").indexOf("/")?$(r).attr("href",""+$(r).attr("href")):0!==$(r).attr("href").indexOf("#")&&$(r).attr("target","_blank")});</script><script type="text/javascript" src="/assets/themes//js/document.js"></script></div></div><script type="text/javascript">var _bdhmProtocol="https:"==document.location.protocol?" https://":" http://";document.write(unescape("%3Cscript src='"+_bdhmProtocol+"hm.baidu.com/h.js%3F4206d67a3ea708c0d2a9354c8d88525f' type='text/javascript'%3E%3C/script%3E"));</script><!-- Latest compiled and minified JavaScript, requires jQuery 1.x (2.x not supported in IE8) --><!-- Placed at the end of the document so the pages load faster --><script src="/assets/themes//js/perfect-scrollbar.min.js"></script><script type="text/javascript">!function(){function e(e,n){var i=$('<div style="display:none;"/>').appendTo($("body"));i.html("<!--[if "+(n||"")+" IE "+(e||"")+"]><a>&nbsp;</a><![endif]-->");var o=i.find("a").length;return i.remove(),o}function n(){function e(){i||(console.log("enable"),i=!0,$(".sidebar").perfectScrollbar({wheelSpeed:10,wheelPropagation:!1}))}function n(){i&&(console.log("disable"),i=!1,$(".sidebar").perfectScrollbar("destroy"))}$(window).width()>760&&$(".sidebar").height()<$(".sidebar ul").height()?e():n()}var i=!1;e(8,"lte")||($(".sidebar").addClass("scrollbar"),n(),$(window).resize(n))}();</script></body></html>