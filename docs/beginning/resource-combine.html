<!DOCTYPE html><html lang="zhCN"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="description" content="_FIS_构建工具_前端工具框架"><meta name="keywords" content=",百度前端团队,FIS,百度FIS,百度前端,fis,前端模块化,前端工程,性能优化,web performance"><title>资源合并- F.I.S</title><meta name="author" content="fis team"><!-- Enable responsive viewport --><meta name="viewport" content="width=device-width,initial-scale=1"><link type="text/css" rel="stylesheet" href="http://fex-team.github.io/fis-site/assets/themes/fis/css/normalize_5f79cb1.css">
<link type="text/css" rel="stylesheet" href="http://fex-team.github.io/fis-site/assets/themes/fis/css/main_217d1b6.css">
<!-- Custom styles --><link type="text/css" rel="stylesheet" href="http://fex-team.github.io/fis-site/assets/themes/fis/css/style_a0a3e75.css">
<!--<link href="/assets/themes/fis/css/highlight/monokai_sublime.css" rel="stylesheet" type="text/css" media="all">--><link type="text/css" rel="stylesheet" href="http://fex-team.github.io/fis-site/assets/themes/fis/css/pygments/github_d92ecad.css">
<link type="text/css" rel="stylesheet" href="http://fex-team.github.io/fis-site/assets/themes/fis/css/perfect-scrollbar.min_0321076.css">
<link type="text/css" rel="stylesheet" href="http://fex-team.github.io/fis-site/assets/css/font-awesome.min_0cd6938.css">
<script type="text/javascript"></script><!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries --><!-- WARNING: Respond.js doesn't work if you view the page via file:// --><!--[if lt IE 9]>
    <script src="http://fex-team.github.io/fis-site/assets/themes/fis/js/html5shiv_3855464.js"></script>
    <script src="http://fex-team.github.io/fis-site/assets/themes/fis/js/respond.min_504acdd.js"></script>
    <![endif]--><!-- Fav and touch icons --><!-- Update these with your own images
      <link rel="shortcut icon" href="images/favicon.ico">
      <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
      <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
      <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
    --><script type="text/javascript" charset="utf-8" src="http://fex-team.github.io/fis-site/assets/themes/fis/js/jquery.min_45ac1eb.js"></script>
<script type="text/javascript" charset="utf-8" src="http://fex-team.github.io/fis-site/assets/themes/fis/js/scrollspy_f211cc4.js"></script>
</head><body><header class="navbar"><section><a href="/fis-site/index.html"><div class="logo"><i class="fa fa-cogs"></i> F.I.S - 前端工具框架</div></a><div class="nav-items"><a href="/fis-site/index.html"><div class="nav-item">首页</div></a> <a href="/fis-site/docs/beginning/getting-started.html"><div class="nav-item">使用文档</div></a> <a href="http://oak.baidu.com"><div class="nav-item">解决方案</div></a> <a target="_blank" href="http://www.imooc.com/learn/220"><div class="nav-item">在线课程</div></a> <a target="_blank" href="http://fex.baidu.com"><div class="nav-item">FEX官网</div></a></div></section></header><div id="wrap"><aside><nav class="sidebar"><ul><li class="item-category"><a href="/fis-site/docs/beginning/getting-started.html">快速入门</a></li><li class="item-sub"><a href="/fis-site/docs/beginning/getting-started.html#optimize">资源压缩</a></li><li class="item-sub"><a href="/fis-site/docs/beginning/getting-started.html#combine">资源合并</a></li><li class="item-sub"><a href="/fis-site/docs/beginning/assist.html">辅助开发</a></li><li class="item-sub"><a href="/fis-site/docs/api/cli.html">命令行</a></li><li class="item-category"><span>进阶使用</span></li><li class="item-sub"><a href="/fis-site/docs/more/fis-standard.html#资源定位">资源定位</a></li><li class="item-sub"><a href="/fis-site/docs/more/fis-standard.html#内容嵌入">内容嵌入</a></li><li class="item-sub"><a href="/fis-site/docs/more/fis-standard.html#依赖声明">依赖声明</a></li><li class="item-sub"><a href="/fis-site/docs/advance/roadmap.html">roadmap详解</a></li><li class="item-sub"><a href="/fis-site/docs/advance/modjs-solution.html">前端模块化</a></li><li class="item-sub"><a href="/fis-site/docs/advance/plugin-list.html">更多插件</a></li><li class="item-category"><a href="/fis-site/docs/dev/intro.html">二次开发</a></li><li class="item-sub"><a href="/fis-site/docs/dev/plugin.html">插件开发</a></li><li class="item-sub"><a href="/fis-site/docs/dev/solution.html">解决方案封装</a></li><li class="item-category"><a href="/fis-site/docs/dev/more.html">更多文档</a></li><li class="item-category"><a href="/fis-site/docs/api/fis-conf.html">配置API</a></li><li class="item-sub"><a href="/fis-site/docs/api/fis-conf.html">配置文件</a></li><li class="item-sub"><a href="/fis-site/docs/api/fis-conf.html#project">project</a></li><li class="item-sub"><a href="/fis-site/docs/api/fis-conf.html#modules">modules</a></li><li class="item-sub"><a href="/fis-site/docs/api/fis-conf.html#settings">settings</a></li><li class="item-sub"><a href="/fis-site/docs/api/fis-conf.html#roadmap">roadmap</a></li><li class="item-sub"><a href="/fis-site/docs/api/fis-conf.html#pack">pack</a></li><li class="item-sub"><a href="/fis-site/docs/api/fis-conf.html#deploy">deploy</a></li><li class="item-category"><a href="/fis-site/docs/api/dev.html">插件开发API</a></li><li class="item-category"><a href="/fis-sitehttps://github.com/fex-team/fis/issues/new">问题反馈</a></li><li class="item-category"><a href="/fis-sitehttps://github.com/fex-team/fis/issues?labels=faq&page=1&state=open">FAQ</a></li></ul></nav><div class="bottom-shadow"></div></aside><div class="container"><article class="doc-content"><div class="toc affix"></div><h1>资源合并</h1><blockquote><p>通过FIS，我们可以引入多种静态资源管理模式，比如百度内部使用的FIS-PLUS解决方案，通过Smarty插件扩展的形式收集静态资源，同时可以根据模块的线上调用统计日志智能化的进行资源合并管理。</p><p>关于FIS的静态资源管理思路，可以参考 <a href="http://www.infoq.com/cn/articles/front-end-engineering-and-performance-optimization-part2/">静态资源管理与模板框架</a>，但是这里描述的是一种较完备的方案，需要根据后端的技术选型进行一些后端模板开发。本篇指南则是介绍一种利用FIS在构建阶段自动完成资源合并工作的方法，使用成本更加低，更加适合中小型项目。</p></blockquote><h2>示例准备</h2><p>本篇指南使用的示例与资源压缩指南中使用的是相同的示例，示例项目的准备工作可以参考<a href="http://fex.baidu.com/fis-site/docs/beginning/getting-started.html">资源压缩</a></p><p>为了达到静态资源自动合并的目的，我们需要扩展FIS的功能，添加插件<a href="https://github.com/hefangshi/fis-postpackager-simple">fis-postpackager-simple</a>，它的功能是收集页面中的已有的script和link标签，将这些标签引用的资源进行自动合并，并将原有的script和link标签替换为自动合并后的标签，最终达到页面级的静态资源合并能力。</p><h2>插件安装</h2><blockquote><p>FIS的编译系统拥有一个使用简单、扩展方便的插件体系，这套插件体系保证了FIS编译工具的灵活性和生命力。这里我们简单介绍一下FIS插件的安装方法，更加详细的插件系统介绍可以查看配置API <a href="http://fex.baidu.com/fis-site/docs/api/fis-conf.html#modules">modules</a>。</p></blockquote><p>插件的安装分为两步，首先我们需要通过<a href="http://npmjs.org">npm</a>包管理工具进行插件安装</p><div class="highlight"><pre><code class="text language-text" data-lang="text">npm install -g fis-postpackager-simple
</code></pre></div><p>插件安装到本地后，我们还需要通过项目配置文件开启插件，修改项目根目录下的fis-conf.js配置，加入fis-postpackager-simple插件</p><div class="highlight"><pre><code class="text language-text" data-lang="text">cd fis-quickstart-demo
vi fis-conf.js
</code></pre></div><div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="c1">//file : fis-conf.js</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;modules.postpackager&#39;</span><span class="p">,</span> <span class="s1">&#39;simple&#39;</span><span class="p">);</span>
</code></pre></div><h2>资源合并</h2><h3>查看项目</h3><p>首先我们按照快速入门中的方法开启本地预览服务器</p><div class="highlight"><pre><code class="bash language-bash" data-lang="bash"><span class="nb">cd </span>fis-quickstart-demo
fis release --optimize
fis server start <span class="c">#如果8080端口被占用，使用-p参数设置可用的端口，可以忽略Java与PHP环境依赖的报错</span>
</code></pre></div><p>查看一下示例项目，我们可以发现所有的静态都是独立加载的。</p><h3>资源合并优化</h3><p>对于<a href="http://www.baidu.com/?isidx=1#wd=%E5%87%8F%E5%B0%91HTTP%E8%BF%9E%E6%8E%A5%E6%95%B0">减少HTTP连接数</a>的必要性在这里我们就不再赘述。让我们直接试试看在fis-postpackager-simple插件支持下，如何通过FIS对这些独立的请求进行合并。</p><div class="highlight"><pre><code class="bash language-bash" data-lang="bash">fis release --optimize --pack
</code></pre></div><p>如果觉得参数输入比较麻烦，实际上也有等价的更短的命令可以灵活组合，更多的参数可以参考<a href="http://fex.baidu.com/fis-site/docs/api/cli.html">命令行</a>。</p><div class="highlight"><pre><code class="bash language-bash" data-lang="bash">fis release -op
</code></pre></div><p>再次浏览我们可以发现所有的脚本资源均被自动合并为了一个文件，并且原来的script标签的引用路径也被自动替换为合并文件的路径。</p><p>不仅如此，fis-postpackager-simple插件还自动将原来在顶部的脚本资源引用移动到了页面最下方，进一步的加快了页面的展现速度，关于fis-postpackager-simple插件更多的静态资源处理策略和使用方法，请参考<a href="https://github.com/hefangshi/fis-postpackager-simple#%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E5%A4%84%E7%90%86%E7%AD%96%E7%95%A5">fis-postpackager-simple</a>。</p><h3>人工干预合并</h3><p>我们可以通过<a href="http://fex.baidu.com/fis-site/docs/api/fis-conf.html#pack">pack</a>设置来干预合并结果。人工干预的必要性在于我们可以将类似underscore、jquery、backbone等基础库固定打包，首先我们可以让不同页面之间公用这些基础库而不用重新下载，其次由于基础库不容易改变，这种策略也对缓存更加友好。</p><p>修改fis-conf.js配置，加入pack配置</p><div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;pack&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="s1">&#39;pkg/lib.js&#39;</span><span class="o">:</span> <span class="p">[</span>
        <span class="s1">&#39;/lib/mod.js&#39;</span><span class="p">,</span>
        <span class="s1">&#39;/modules/underscore/**.js&#39;</span><span class="p">,</span>
        <span class="s1">&#39;/modules/backbone/**.js&#39;</span><span class="p">,</span>
        <span class="s1">&#39;/modules/jquery/**.js&#39;</span><span class="p">,</span>
        <span class="s1">&#39;/modules/vendor/**.js&#39;</span><span class="p">,</span>
        <span class="s1">&#39;/modules/common/**.js&#39;</span>
    <span class="p">]</span>
<span class="p">});</span>
</code></pre></div><p>再次运行FIS构建项目</p><div class="highlight"><pre><code class="bash language-bash" data-lang="bash">fis release -op
</code></pre></div><p>我们会发现原有的 <code>auto_combine_0.js</code> 被分解为了 <code>auto_combine_0.js</code> 和 <code>lib.js</code> ，<code>lib.js</code> 被独立打成了一个包。</p><h3>合并图片</h3><p>通过上述几个步骤，我们已经成功将脚本资源和样式表资源进行了合并，但是为了进一步的减少HTTP连接数，我们还可以对引用的图片资源进行进一步的合并。</p><p>用于图片合并的插件<a href="https://github.com/fex-team/fis-spriter-csssprites">csssprites</a>已经在FIS中内置了，因此无需安装，只需要在fis-conf.js的配置中开启即可</p><div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="c1">//为所有样式资源开启csssprites</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;roadmap.path&#39;</span><span class="p">,</span> <span class="p">[{</span>
    <span class="nx">reg</span><span class="o">:</span> <span class="s1">&#39;**.css&#39;</span><span class="p">,</span>
    <span class="nx">useSprite</span><span class="o">:</span> <span class="kc">true</span>
<span class="p">}]);</span>
<span class="c1">//设置csssprites的合并间距</span>
<span class="nx">fis</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;settings.spriter.csssprites.margin&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>
</code></pre></div><blockquote><p>使用csssprites合并的图片需要在图片路径处添加query标识，示例项目中已经预先添加，更详细的使用方法可以参考<a href="https://github.com/fex-team/fis-spriter-csssprites#%E4%BD%BF%E7%94%A8">使用文档</a></p></blockquote><p>再次运行FIS构建项目</p><div class="highlight"><pre><code class="bash language-bash" data-lang="bash">fis release -op
</code></pre></div><p>再次查看项目，添加几个待办项，我们会发现所有待办项的图片都合并在了一张图片中。</p><h2>写在最后</h2><p>至此，我们完整的演示了如何使用FIS对一个传统的Web项目如何进行资源压缩、合并等优化工作，大幅提高网站性能，并且整个过程需要的配置文件也非常的少，而配置完成后仅需一个命令，就可以完成一系列的优化工作，节约大量的手工维护成本。</p><p>但是这样就满足还是太早了，有没有觉得就算有了资源自动合并，但是每次还要手动的添加资源引用是一件非常繁琐的事情，并且可能有一天某个资源已经不需要使用了，还需要去手工维护这段代码的引用是不是非常烦恼呢？</p><p>实际上这些问题都可以用前端模块化来解决，通过前端模块化开发，我们可以不再担心各种资源加载问题，就像编写Node.js程序一样编写前端项目。那么除了业界流行的各种前端模块化加载库，FIS也提供了一种新的思路来解决模块化加载问题，点击<a href="http://fex.baidu.com/fis-site/docs/advance/modjs-solution.html">前端模块化</a>了解更多。</p><!--  --><br><strong>有任何问题，请在 <a href="https://github.com/fex-team/fis/issues">https://github.com/fex-team/fis/issues</a> 讨论</strong></article><script type="text/javascript">$("a").each(function(t,r){0===$(r).attr("href").indexOf("/")?$(r).attr("href",""+$(r).attr("href")):0!==$(r).attr("href").indexOf("#")&&$(r).attr("target","_blank")});</script><script type="text/javascript" charset="utf-8" src="http://fex-team.github.io/fis-site/assets/themes/fis/js/document_f64176c.js"></script>
</div></div><script type="text/javascript">var _bdhmProtocol="https:"==document.location.protocol?" https://":" http://";document.write(unescape("%3Cscript src='"+_bdhmProtocol+"hm.baidu.com/h.js%3F4206d67a3ea708c0d2a9354c8d88525f' type='text/javascript'%3E%3C/script%3E"));</script><!-- Latest compiled and minified JavaScript, requires jQuery 1.x (2.x not supported in IE8) --><!-- Placed at the end of the document so the pages load faster --><script type="text/javascript" charset="utf-8" src="http://fex-team.github.io/fis-site/assets/themes/fis/js/perfect-scrollbar.min_6dcf0df.js"></script>
<script type="text/javascript">!function(){function e(e,n){var i=$('<div style="display:none;"/>').appendTo($("body"));i.html("<!--[if "+(n||"")+" IE "+(e||"")+"]><a>&nbsp;</a><![endif]-->");var o=i.find("a").length;return i.remove(),o}function n(){function e(){i||(console.log("enable"),i=!0,$(".sidebar").perfectScrollbar({wheelSpeed:10,wheelPropagation:!1}))}function n(){i&&(console.log("disable"),i=!1,$(".sidebar").perfectScrollbar("destroy"))}$(window).width()>760&&$(".sidebar").height()<$(".sidebar ul").height()?e():n()}var i=!1;e(8,"lte")||($(".sidebar").addClass("scrollbar"),n(),$(window).resize(n))}();</script></body></html>